<!DOCTYPE html>
<html lang="en">
<head>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>
  <div id="plotDiv"></div>
  
  <h3>Select normalization mode:</h3>
  <div>
    <input type="radio" id="rawScore" name="scoreType" value="score" checked>
    <label for="rawScore">Raw Score</label><br>
    <input type="radio" id="idealScore" name="scoreType" value="score_ideal">
    <label for="idealScore">Normalized Score (Ideal Tool)</label><br>
    <input type="radio" id="bvtScore" name="scoreType" value="score_bvt">
    <label for="bvtScore">Normalized Score (RBVT)</label>
  </div>

  <script>
    // Initial tools to display
    const initialTools = ["Ideal Tool", "RBVT", "ITS-Tools", "Tapaal", "LoLA", "enpac", "GreatSPN", "smpt"];

    // Load the CSV data
    Plotly.d3.csv("{{csv_file}}", function(err, data){
      var toolNames = [...new Set(data.map(row => row.tool))];
      var traces = [];
      
      var scoreType = document.querySelector('input[name="scoreType"]:checked').value;

      // Create a trace for each tool
      toolNames.forEach(function(toolName) {
        var toolData = data.filter(row => row.tool === toolName);
        var trace = {
          x: toolData.map(row => row.year),
          y: toolData.map(row => parseFloat(row[scoreType])),
          mode: 'lines+markers',
          name: toolName,
          line: {
            shape: 'linear'
          },
          visible: initialTools.includes(toolName) ? true : 'legendonly'  // Show initial tools
        };
        traces.push(trace);
      });

      // Plot layout
      var layout = {
        title: '{{plot_id}}',
        xaxis: {
          title: 'Year',
          type: 'category'
        },
        yaxis: {
          title: 'Score'
        },
        legend: {
          orientation: 'h',
          y: -0.5  // Position the legend below the plot
        },
        colorway: [
            "rgb(229, 134, 6)","rgb(93, 105, 177)","rgb(82, 188, 163)","rgb(153, 201, 69)",
            "rgb(204, 97, 176)","rgb(36, 121, 108)","rgb(218, 165, 27)","rgb(47, 138, 196)",
            "rgb(118, 78, 159)","rgb(237, 100, 90)","rgb(165, 170, 153)","rgb(136, 204, 238)",
            "rgb(204, 102, 119)","rgb(221, 204, 119)","rgb(17, 119, 51)","rgb(51, 34, 136)",
            "rgb(170, 68, 153)","rgb(68, 170, 153)","rgb(153, 153, 51)","rgb(136, 34, 85)",
            "rgb(102, 17, 0)","rgb(136, 136, 136)","rgb(95, 70, 144)","rgb(29, 105, 150)",
            "rgb(56, 166, 165)","rgb(15, 133, 84)","rgb(115, 175, 72)","rgb(237, 173, 8)",
            "rgb(225, 124, 5)","rgb(204, 80, 62)","rgb(148, 52, 110)","rgb(111, 64, 112)",
            "rgb(102, 102, 102)"
          ] 
      };

      // Draw the initial plot
      Plotly.newPlot('plotDiv', traces, layout);

      // Add radio button listener for score normalization mode
      document.querySelectorAll('input[name="scoreType"]').forEach((elem) => {
        elem.addEventListener("change", function(event) {
          var value = event.target.value;
          traces.forEach(function(trace, i) {
            trace.y = data.filter(row => row.tool === trace.name).map(row => parseFloat(row[value]));
          });
          Plotly.newPlot('plotDiv', traces, layout);
        });
      });
    });
  </script>
</body>
</html>
